# =====================================================
# GateWey Requisition Management System
# Attachments Directory Security Configuration
# File Location: /requisition-app/uploads/attachments/.htaccess
# =====================================================

# ===== DENY ALL DIRECT ACCESS =====
# Attachment files may contain sensitive business information
# They must ONLY be accessed through authenticated PHP scripts
Order Deny,Allow
Deny from all

# ===== PREVENT DIRECTORY LISTING =====
# Never allow anyone to see a list of attachment files
Options -Indexes

# ===== DISABLE ALL SCRIPT EXECUTION =====
# Prevent any uploaded file from being executed
php_flag engine off

# Additional script execution prevention
<FilesMatch "\.(php|php3|php4|php5|phtml|pl|py|jsp|asp|aspx|cgi|sh|exe|bat|cmd)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# ===== DISABLE CGI EXECUTION =====
Options -ExecCGI
AddHandler cgi-script .php .php3 .php4 .php5 .phtml .pl .py .jsp .asp .aspx .htm .shtml .sh .cgi .exe

# ===== SECURITY HEADERS =====
<IfModule mod_headers.c>
    # Prevent MIME type sniffing - crucial for security
    Header set X-Content-Type-Options "nosniff"
    
    # Prevent files from being displayed in frames
    Header set X-Frame-Options "DENY"
    
    # Force download of all files (never display in browser)
    Header set Content-Disposition "attachment"
    
    # No caching of sensitive documents
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "0"
</IfModule>

# ===== PREVENT ACCESS TO HIDDEN FILES =====
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# ===== RESTRICT FILE TYPES =====
# Only allow PDF and image files (supporting documents)
<FilesMatch "!\.(pdf|jpg|jpeg|png|gif)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# ===== PREVENT ANY INCLUDES =====
<IfModule mod_rewrite.c>
    RewriteEngine On
    # Block any attempt to access files directly
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule .* - [F,L]
</IfModule>

# ===== BLOCK EXECUTABLE FILES =====
<FilesMatch "\.(exe|bat|cmd|com|msi|scr|dll|so|dylib)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# ===== ADDITIONAL MIME TYPE RESTRICTIONS =====
<IfModule mod_mime.c>
    # Remove handlers for executable types
    RemoveHandler .php .php3 .php4 .phtml .pl .py .jsp .asp .htm .shtml .sh .cgi
    RemoveType .php .php3 .php4 .phtml .pl .py .jsp .asp .htm .shtml .sh .cgi
</IfModule>

# ===== END OF .HTACCESS =====
# Remember: Files in this directory should ONLY be served
# through your secure download script with authentication checks
